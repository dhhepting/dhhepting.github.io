{% comment %}
{% endcomment %}
{% assign url_parts = turl | split: '/' %}
{% assign sem_size = 4 %}
{% assign courses = "" %}
{% assign semoffs = "" %}
{% assign crs_id = "" %}
{% assign sems = "" %}
{% for sp in site.pages %}
  {% if sp.url contains "teaching" %}
    {% assign url_parts = sp.url | split: '/' %}
    {% if url_parts.size == sem_size %}
	{% comment %}
      {% assign crsoff = url_parts[2] | replace: '-', ' ' %}
	{% endcomment %}
      {% assign crsoff = url_parts[2] %}
      {% assign crs_part = url_parts[2] | split: '-' %}
      {% if crs_part.size == 2 %}
        {% assign semoff = url_parts | last %}
        {% capture  semoffurl %}{{semoff}}/{%endcapture%}
        {% if semoff contains "2" %}
          {% capture crsurl  %}{{ sp.url | remove: semoffurl }}{%endcapture%}
          {% capture courses %}{{courses}}|{{crsurl}}#{{sp.crs_id}}#{{sp.crs_name}}#{{sp.description}}{% endcapture %}
          {% capture crs_id %}{{crs_id}}{{crsoff}},{% endcapture %}
          {% capture semoffs %}{{semoffs}}|{{crsoff}}#{{semoff}}{% endcapture %}
        {% endif %}
      {% endif %}
    {% endif %}
  {% endif %}
{% endfor %}

{% assign sortedcourses = courses | split: '|' | uniq | sort %}
{% assign sortedcrs_id = crs_id | split: ',' | uniq | sort %}
{% capture numcourses %}{{ sortedcourses.size | minus:1 }}{% endcapture %}
{% assign sortedsemoffs = semoffs | split: '|' | sort %}

### Jump to a Course Offering

<!-- Jump to a class and semester -->
<form class="form-inline">
  <div class="form-group">
    <select id = "tcourse" class="form-control" onchange="CourseChange()">
      <option value="tc_title">Course</option>
      {% for cid in sortedcrs_id %}
        <option value="{{ cid  | replace: " ","-"}}">{{ cid }}</option>
      {% endfor %}
    </select>
  </div>
  &nbsp; / &nbsp;
  <div class="form-group">
    <select id="tsem" disabled class="form-control" onchange="SemesterChange()">
      <option value="ts_title">Semester</option>
    </select>
  </div>
  &nbsp; / &nbsp;
  <a id="jumplink" href="#" target="_self" class="btn btn-primary" role="button">
    Go
  </a>
</form>

### Courses

{% for i in (1..numcourses) %}
    {%- assign cc = sortedcourses[i] | split: '#' -%}
  * [{{cc[1]}} : {{cc[2]}}]({{cc[0]}})
{% endfor %}

<script>
    var jmpurl = document.getElementById("jumplink");
    var semsel = document.getElementById("tsem");
    var liqsems = {{ sortedsemoffs | jsonify }}
    
    var t_course = "tc_title";
    var t_sem = "ts_title";
		
    function SetJump() 
    {
        if (t_course != "tc_title" && t_sem != "ts_title") 
	{
	    jmpurl.setAttribute("href","/teaching/" + t_course + "/" + t_sem + "/");
	    jmpurl.setAttribute("target","_blank");
	}
	else 
	{
	    jmpurl.setAttribute("href","#");
	    jmpurl.setAttribute("target","_self");
	}
    }

    function removeOptions(selectbox) 
    {
	// remove everything but the 1st option
	for (var i = selectbox.options.length - 1 ; i >= 1 ; i--) 
	{
	    selectbox.remove(i);
    	}
    	selectbox.options[0].selected = true;
    }

    function CourseChange() 
    {
    	// clear out the current contents of the semester select
	var e = document.getElementById("tcourse");
	removeOptions(semsel);
	t_sem = "ts_title";
	t_course = e.options[e.selectedIndex].value;
	SetJump();
	// find the course in the array
	if (t_course != "tc_title") {
	    document.getElementById("tsem").disabled=false;
	    // build new contents
	    for (var i = 1; i < liqsems.length; i++) {
		var res = liqsems[i].split("#");
		if (t_course == res[0]) {
		    semsel.options.add(new Option(res[1],res[1],false));
		}
	    }
	}
	else {
	    document.getElementById("tsem").disabled=true;
	}
    }
		
    function SemesterChange() {
        var e = document.getElementById("tsem");
	t_sem = e.options[e.selectedIndex].value;
	SetJump();
    }
</script>
